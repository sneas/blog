{"componentChunkName":"component---src-templates-blog-post-js","path":"/deploy-dist-folder-to-gh-pages-with-circleci/","webpackCompilationHash":"73be459192e94da462fb","result":{"data":{"site":{"siteMetadata":{"title":"Insights","author":"Dmitry Snisarenko"}},"markdownRemark":{"id":"be5270d5-0d1c-5561-95d3-f3278a9ce2e0","excerpt":"I would like to share how to automatically publish generated () folder to GitHub\npages with the help of CircleCI. This is not a -based solution because keeping…","html":"<p>I would like to share how to automatically publish generated (<code class=\"language-text\">dist</code>) folder to GitHub\npages with the help of CircleCI. This is <strong>not</strong> a <code class=\"language-text\">git subtree</code>-based solution because keeping\nautomatically generated content in Git repo is… meh.</p>\n<p>Our pre-requisites are:</p>\n<ul>\n<li><code class=\"language-text\">dist</code> folder is automatically generated by a script on CI</li>\n<li><code class=\"language-text\">dist</code> folder is excluded from Git repo by <code class=\"language-text\">.gitignore</code></li>\n<li><code class=\"language-text\">gh-pages</code> gets auto refreshed with the latest content from <code class=\"language-text\">dist</code> folder on each commit</li>\n</ul>\n<p>Current blog is successfully working with the same principles. You can check the CI configuration\nout\n<a href=\"https://github.com/sneas/blog/tree/master/.circleci\">here<i class=\"fa fa-github pl-1\"></i></a>.</p>\n<h3>Bash script file</h3>\n<p>First of all we are going to create bash script and save it in <code class=\"language-text\">.circleci/push-gh-pages.sh</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> -z <span class=\"token string\">\"<span class=\"token variable\">$GH_NAME</span>\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> config user.name <span class=\"token string\">\"<span class=\"token variable\">$GH_NAME</span>\"</span>\n<span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> -z <span class=\"token string\">\"<span class=\"token variable\">$GH_EMAIL</span>\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> config user.email <span class=\"token string\">\"<span class=\"token variable\">$GH_EMAIL</span>\"</span>\n\n<span class=\"token assign-left variable\">MAIN_BRANCH</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> symbolic-ref --short HEAD<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">DIST</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${1<span class=\"token operator\">:-</span>dist}</span>\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">git</span> stash\n<span class=\"token function\">git</span> branch --delete --force gh-pages\n<span class=\"token function\">git</span> checkout --orphan gh-pages\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> -f <span class=\"token variable\">$DIST</span>\n<span class=\"token function\">git</span> commit -m <span class=\"token string\">\"Rebuild GitHub pages [ci skip]\"</span>\n<span class=\"token function\">git</span> filter-branch -f --prune-empty --subdirectory-filter <span class=\"token variable\">$DIST</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> push -f origin gh-pages\n<span class=\"token function\">git</span> checkout <span class=\"token variable\">$MAIN_BRANCH</span>\n<span class=\"token function\">git</span> stash apply <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">:</span></code></pre></div>\n<p>Don’t forget to give the script necessary permissions.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">chmod</span> +x .circleci/push-gh-pages.sh</code></pre></div>\n<h3>CircleCI config file</h3>\n<p>It’s time to create/update CI config file <code class=\"language-text\">.circleci/config.yml</code>.</p>\n<p>I commented <code class=\"language-text\"># docker image</code> and <code class=\"language-text\"># necessary steps to create dist folder</code> because images and steps\ncould very from project to project. If you’re wondering how it’s done for this blog you can refer to\n<a href=\"https://github.com/sneas/blog/tree/master/.circleci/config.yml\">this config <i class=\"fa fa-github pl-1\"></i></a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># docker image</span>\n    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> ~/repo\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> master\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> checkout\n      <span class=\"token comment\"># necessary steps to create dist folder </span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> sh .circleci/push<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages.sh dist</code></pre></div>\n<p>Btw it’s not necessary to have <code class=\"language-text\">dist</code> folder as a provide for <code class=\"language-text\">gh-pages</code>.\nYou can provide any folder to <code class=\"language-text\">.circleci/push-gh-pages.sh</code>.\nEx: <code class=\"language-text\">sh .circleci/push-gh-pages.sh docs</code>.\nYou don’t have to provide any folder name (ex <code class=\"language-text\">sh .circleci/push-gh-pages.sh</code>) and it will\nbe default to <code class=\"language-text\">dist</code>.</p>\n<h3>Set up project in CircleCI</h3>\n<p>After registering with your GitHub account you can click <code class=\"language-text\">Add Projects</code> button in the navigation\npanel.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 140px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/d49f7506b33998c49aa67152dc482ee9/1d1f1/add-projects-button.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 118.57142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAABYlAAAWJQFJUiTwAAACFUlEQVQ4y61Vy6t5YRQ9f56Jx/Um5JH3u7xJFAaijCRFSRkYkTIwMDGgGCkDA3+GgdG67V3ndOh37+/QVbt9fI+117fXOt8RTCYT/jKE3yaNRuPbc4KSDQaDQQpx/C3AVzCr1Qq73Q6bzSaN/QQq/ARmNpuhUqnQ6/Vwu91wOp1wuVxwPB7hcrmg1+vfY2ixWNBqtbBYLEC/+XyO8/mM+/2OQCAAnU7HRRUD0uLJZILlcontdotYLMYFrtcrQqEQA77FkACHwyFWqxUzXK/XfPTH4wG/3/8Zw+l0ik6ng8PhgN1uh/1+j81mA4fDIQmj2DbEYDQaYTabYTAY8DMJpNVqP1NZzD6fTwqPx8NifexDymSPr68vznKrfAxIYNRPepbH20cmNk6nE/l8Hul0mnOlUkEmk3kCVcSQGFHzCYS82Gg00Gw2WfFaraZMZXlF8YjkN6/Xi1wuh3A4jFQqhUgkwmCvHhT3C3L6ogCiCBqNhu1DbNVqNf+noHkaF7O8p4L8VolGo/yKJZNJZkfZ7XbzLUPsaI7WJBIJZLNZxONxXkNWkhjK6bbbbXS7XTZyv99nEQqFAm8cj8col8vcw2AwyH0lgcjs8tvnCZCqkrIEQoKUSiUUi0VUq1XU63UGIFAqQGypv3Rh0CkkwNce0tFFE4viiEXpohVFk6ssfxWF35z/auBXY/9rjfC/j5HSeAL8y/gGA0L61adVzgYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Add Projects Button\"\n        title=\"Add Projects Button\"\n        src=\"/blog/static/d49f7506b33998c49aa67152dc482ee9/1d1f1/add-projects-button.png\"\n        srcset=\"/blog/static/d49f7506b33998c49aa67152dc482ee9/1d1f1/add-projects-button.png 140w\"\n        sizes=\"(max-width: 140px) 100vw, 140px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Find the needed project in the list and click <code class=\"language-text\">Set Up Project</code>.</p>\n<p>Set up necessary preferences and click <code class=\"language-text\">Start Building</code>.</p>\n<p>We’re almost there.</p>\n<p>Now you should go to the project settings by clicking</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 68px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ee522caddaaaf2d2030dff5dd6aac046/08bde/project-settings-button.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102.94117647058825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAABeklEQVQ4y62Vu46CUBCGeQwridpaQGOlHbWJvIIvYtToC/gUFiQWPAaNsRJiMGoU7xcuofo3M8lZyUZ3F4RkOJw5w8cM83OQgiCA7/ugMQzDzCY4Ep3I8Xg8cLlccL1eUxvdR0AyiWDn8xnz+RyO42Qy27Z5vN/vkKIowmKxwGazwe1246elNQK5rov1ev0Eep7HmZ5Op5d2PB7frhGUYKvV6gnc7Xa8IIKScPJT9klf8preI8HeAkXw4XDgzCj75XKJ/X7/7UvG/QkUwaQAOobDIRRFwXg85jm9s1RAEdjtdhnWaDRQKBTQarXQ7/cxGo1YaiLTX4FUUhzHmEwmKBaLKJfL0DSN4QSWZRnVahXT6ZQrIOi/Mtxut2i321yqZVlcqmmaqFQq6PV6DEnVFAFUVRWz2YyBhmGkB/4suVQqodlsotPpoFar8TxTycmm1Ot1boqu6+mb8ko2g8EgH9kIEdMaCZvmHwn7o08v980ht+0r9w0271/AF93u3SH4+pBkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Project Settings Button\"\n        title=\"Project Settings Button\"\n        src=\"/blog/static/ee522caddaaaf2d2030dff5dd6aac046/08bde/project-settings-button.png\"\n        srcset=\"/blog/static/ee522caddaaaf2d2030dff5dd6aac046/08bde/project-settings-button.png 68w\"\n        sizes=\"(max-width: 68px) 100vw, 68px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Go to <code class=\"language-text\">Environment Variables</code> and set up <code class=\"language-text\">GH_NAME</code> and <code class=\"language-text\">GH_EMAIL</code> variables.\nThese are name and email being used for committing to <code class=\"language-text\">gh-pages</code>.\nYou can use your GitHub email and name suffixed with <code class=\"language-text\">(CI)</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ffc006dc5ecb63349efb72070d2df2cd/ad34c/environment_variables_name_and_email.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.66197183098592%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACf0lEQVQ4y41TyY7TUBD0f3FjOYAEBw4ICcGV3+CCEFd+AQnQsGhYDtyR4IKEkpBMFrJvThwv8Z7YTtH1Ms/ySEiMpcrruPt1V3e1jSzLcNknLw7wkhybKIcdC6Kj7Yid7AsURQ5jt9vBsiy4rgvHcRS0vdlslG+xNOHZawycPe6dhnj0JcSDTyEefg7x+GuE6298vPiZqqJGmqbodDolut0u6vU6+v0+xuMxGo0Gmq0znP2uo22GuPk2xA1JcPWVj2uvfdw6CXD3Q4CTs52kOxwT9no9TKdTtNtttFotlbhWq2E4HF5oeegdVLLb7wLcEdz/GODKSx/v2zvlz3JJmOc5iP1+D7bPAtqOokjmUoi/kPACVlTg+Y8YT7/HeCag/eRbjF9mVs7Y4OXLPIfD/2MosMGf1WoF27ax3W7VqYUhKAr9vu8r38Z2jrGeB9dx4bmeEm+9XkvRc4YUguDMeHKWFGQymaiZEvRRKBU3m2O8sjCQk5jN51iZ5jEhGc4XC8zl5WK5VDaTmau1qroWdqYED0cjxdSUmE2cYhQksFK5G++Qn7dcKIaSsOuGGGwjhZ4bYBElGG5DjP0If+QcyNnzQlhx+s+BkplGqTKZZnJqh76Ui8r0qTixq5cJ+orKe4OXOHguMEWoVuTDGXMvR9JylZFqURI1m001V45MJeTLOI5LhTk37uBx/47MwzBUO+mJstxT7SNo63jCYFYm45dCMahmkiQlSwazOgWZzWYIgqBkp1tmMdoqIX/IQO/SQlSuBrBlMqOPI9FMNJiQBC4w5NIuZR3IkgxZQM+KDOkje7LUbWrwP0dWisKZaKWqbTARQYY6CU/9vgr97RN/AfaKCCXHNKS9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Environmane Variables\"\n        title=\"Environmane Variables\"\n        src=\"/blog/static/ffc006dc5ecb63349efb72070d2df2cd/b9e4f/environment_variables_name_and_email.png\"\n        srcset=\"/blog/static/ffc006dc5ecb63349efb72070d2df2cd/cf440/environment_variables_name_and_email.png 148w,\n/blog/static/ffc006dc5ecb63349efb72070d2df2cd/d2d38/environment_variables_name_and_email.png 295w,\n/blog/static/ffc006dc5ecb63349efb72070d2df2cd/b9e4f/environment_variables_name_and_email.png 590w,\n/blog/static/ffc006dc5ecb63349efb72070d2df2cd/ad34c/environment_variables_name_and_email.png 710w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now you can go to <code class=\"language-text\">Checkout SSH Keys</code> section of project settings and click <code class=\"language-text\">Create and add user key</code> button.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/62380f50b76bf571292ccdbc3a6abcb0/be18a/create-and-add-user-key.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.2356495468278%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVQoz62TW4+CQAyF/f+/TQQUAe/c0RC8i7x183VT4sbNxod9ONDpnDntmcLofD7LarVS7HY72Ww2kiSJXK9XeTwecr/fPwLcy+UiIx5hGEocxxJFkSyXS11D6vtens/nn4ADuq77Fjwej7Lf76UoiqG7LMskz3NZr9eSpqnmidkzF9vtVnnWwOFwkNvtJqPT6aR2SU6nU/F9X+bzuQRBMHTM/mKxUBcIzmYz5ZKDRyG60w4RhAg4PB6PlUwBBDlsd8ya7ijoeZ4Kcqaua7WvggzFLFAdIewBchwiNlFicmaXmEI0xiAHy1idTCZKMOvYIaYjYINjjzunK5vwMGVUEWU4vOm4bdthbblXjuV+/WwQBE3T6GRBWZbaATHWiMlVVaVvcvBfRd865GK5aMdx1BJgzVBc19UY+1wDg6OYCb5ZJmnvTwGf787+ph9/CpX+A2h9AbgPd02RDzyEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Create And Add User Key\"\n        title=\"Create And Add User Key\"\n        src=\"/blog/static/62380f50b76bf571292ccdbc3a6abcb0/b9e4f/create-and-add-user-key.png\"\n        srcset=\"/blog/static/62380f50b76bf571292ccdbc3a6abcb0/cf440/create-and-add-user-key.png 148w,\n/blog/static/62380f50b76bf571292ccdbc3a6abcb0/d2d38/create-and-add-user-key.png 295w,\n/blog/static/62380f50b76bf571292ccdbc3a6abcb0/b9e4f/create-and-add-user-key.png 590w,\n/blog/static/62380f50b76bf571292ccdbc3a6abcb0/be18a/create-and-add-user-key.png 662w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We’re done. Now you can got to your project, click on the latest build and click <code class=\"language-text\">Rebuild</code> button.</p>","frontmatter":{"title":"Deploy dist folder to GitHub Pages with CircleCI","date":"October 07, 2018","description":"Step by step instruction on automatically building and deploying Github pages with the help of CircleCI."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/deploy-dist-folder-to-gh-pages-with-circleci/","previous":{"fields":{"slug":"/its-working/"},"frontmatter":{"title":"Wow, it's working"}},"next":{"fields":{"slug":"/unit-testing/"},"frontmatter":{"title":"On unit testing"}}}}}